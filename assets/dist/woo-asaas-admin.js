(()=>{"use strict";var e=new URLSearchParams(window.location.search);jQuery((function(a){if(o=e.get("tab"),n=e.get("section"),"woocommerce_page_wc-settings"===window.adminpage&&"checkout"===o&&["asaas-credit-card"].includes(n)){var o,n,t=e.get("section"),c=window.ajaxurl,i=window._wooAsaasAdminSettings.nonce,r=a("#woocommerce_".concat(t,"_endpoint")),s=a("#woocommerce_".concat(t,"_anticipation")),d=a("#woocommerce_".concat(t,"_api_key")),u=a('<span class="preloader"></span>'),p=a(".woocommerce-save-button"),l=""===d.val(),f=!1,m=!1;d.on("change",(function(){(l||""===a(this).val())&&(s.prop("checked",!1),s.prop("disabled",!0))})),r.on("change",(function(){return h()})),s.on("change",(function(){a(this).prop("checked")&&!f?(s.after(u),s.hide(),a.ajax({url:c,data:{action:"check_anticipation_allowed_person_type",_nonce:i},beforeSend:function(){v()},success:function(e){var a=e.data;m="JURIDICA"===a.personType,w()},error:function(){f=!1,u.remove(),s.prop("checked",!1),s.prop("disabled",!0),s.show(),p.prop("disabled",!1)}})):h()})),a.ajax({url:c,type:"POST",data:{action:"check_anticipation_allowed"},success:function(e){var a=e.data;m=!!a.allowAnticipation}}),p.on("click",(function(){m||s.prop("checked",!1)}))}function h(){s.prop("checked",!1),s.after(u),s.hide(),a.ajax({url:c,type:"POST",data:{action:"check_anticipation_option",_nonce:i},beforeSend:function(){v()},success:function(){w()}})}function v(){f=!0,s.prop("disabled",!0),p.prop("disabled",!0)}function w(){f=!1,s.prop("disabled",!1),u.remove(),s.show(),p.prop("disabled",!1)}})),jQuery((function(a){var o,n,t,c=e.get("section"),i=window.ajaxurl,r=window._wooAsaasAdminSettings.nonce,s=a("#woocommerce_".concat(c,"_anticipation")),d=a("#woocommerce_".concat(c,"_endpoint")),u=a("#woocommerce_".concat(c,"_api_key")),p=a("#woocommerce_".concat(c,"_email_notification")),l=a(".reenable-queue"),f=a(".woocommerce-save-button"),m=a("#webhook-status-connection"),h=a("#webhook-status-queue"),v=a('<span class="preloader"></span>'),w=a('<span class="apikey-message"></span>');function _(e){v.remove(),w.remove(),u.after(v),a.ajax({url:i,type:"POST",data:{action:"check_webhook_setting",url:e.enviromentUrl,api_key:e.apiKey,_nonce:e.ajaxNonce},beforeSend:function(){b()},success:function(e){if(v.remove(),!e.success||e.data)if(u.after(w),w.html("✅ Chave de API válida."),b(!1),e.success){s.prop("disabled",!1);var o=e.data[0].enabled,n=e.data[0].interrupted;g(!e.data[0].authToken||!o||n),t=e.data[0].email,p.val()!==t&&a.ajax({url:i,type:"POST",data:{action:"update_existing_webhook_email"}})}else s.prop("disabled",!0),b(!1),g(!1),v.remove(),u.after(w),w.html("❌ Chave de API inválida.");else b(!1);var t}})}function b(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];f.prop("disabled",e)}function g(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?l.attr("disabled",!0):l.removeAttr("disabled")}o=e.get("tab"),"woocommerce_page_wc-status"!==window.adminpage||"status"!==o&&o||a.ajax({url:i,data:{action:"check_webhook_status"},success:function(e){if(m.find(".loader").hide(),h.find(".loader").hide(),e.success){var a=e.data[0].enabled,o=e.data[0].interrupted,n=e.data[0].authToken;m.find(".connection-yes").show(),n&&a&&!o?h.find(".queue-yes").show():h.find(".queue-error").show(),g(!n||!a||o)}else m.find(".connection-error").show(),h.find(".queue-error").show()},error:function(){m.find(".connection-error").show(),h.find(".queue-error").show()}}),function(){var a=e.get("tab"),o=e.get("section");return"woocommerce_page_wc-settings"===window.adminpage&&"checkout"===a&&["asaas-ticket","asaas-credit-card","asaas-pix"].includes(o)}()&&(n=u.val(),t=d.val(),d.on("change",(function(){t=a(this).val();var e=u.val();""!==e&&(w.remove(),_({enviromentUrl:t,apiKey:e,ajaxNonce:r}))})),u.on("input",function(e){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var n=this,t=arguments.length,c=new Array(t),i=0;i<t;i++)c[i]=arguments[i];clearTimeout(a),a=setTimeout((function(){return e.apply(n,c)}),o)}}((function(){var e=a(this).val();if(w.remove(),""===e)return g(!1),v.remove(),void w.remove();_({enviromentUrl:t,apiKey:e,ajaxNonce:r})}),1200)),""!==n&&_({enviromentUrl:t,apiKey:n,ajaxNonce:r})),p.prop("required",!0),l.on("click",(function(e){e.preventDefault(),g(!1),a.ajax({url:i,type:"POST",data:{action:"update_existing_webhook_queue"},beforeSend:function(){l.html('<span class="preloader"></span> Aguarde...')},success:function(e){if(e.success){var o=e.data,n=o.enabled,t=o.authToken,c=o.interrupted;g(!n||!t||c),h.find(".error").removeClass("error").addClass("yes"),h.find(".dashicons-no").removeClass("dashicons-no").addClass("dashicons-yes");var i=a('<span class="reenable-message"></span>');i.insertAfter(l),i.html("✅ Fila reativada com sucesso"),l.text("Reabilitar fila de webhooks"),setTimeout((function(){i.remove()}),5e3)}},error:function(){}})}))}))})();